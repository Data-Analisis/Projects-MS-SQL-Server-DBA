<!DOCTYPE HTML>
<html lang="en">
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8" />
<title>zabbix.GetExistsErrorInLog</title>
<script src="../../../../../../scripts/jquery-1.12.0.min.js" type="text/javascript"></script>
<script src="../../../../../../scripts/bootstrap.min.js" type="text/javascript"></script>
<script src="../../../../../../scripts/clipboard.min.js" type="text/javascript"></script>
<script src="../../../../../../scripts/main.js" type="text/javascript"></script>
<link rel="stylesheet" href="../../../../../../styles/bootstrap/Default.css" type="text/css">
<link rel="stylesheet" href="../../../../../../styles/main.css" type="text/css">
</head>
<body>
  <div class="page-wrap">
    <div class="header">
      <div class="row">
        <div class="col-xs-12">
          <ol class="breadcrumb">
            <li><a href="../../../../../../startpage.html" data-mapping-enabled="true">Project</a></li>
            <li><a href="../../../../../../Servers\Servers.html" data-mapping-enabled="true">Servers</a></li>
            <li><a href="../../../../../../Servers\SRV\SRV.html" data-mapping-enabled="true">SRV</a></li>
            <li><a href="../../../../../../Servers\SRV\UserDatabases\UserDatabases.html" data-mapping-enabled="true">User databases</a></li>
            <li><a href="../../../../../../Servers\SRV\UserDatabases\SRV\SRV.html" data-mapping-enabled="true">SRV</a></li>
            <li><a href="../../../../../../Servers\SRV\UserDatabases\SRV\Programmability\Programmability.html" data-mapping-enabled="true">Programmability</a></li>
            <li><a href="../../../../../../Servers\SRV\UserDatabases\SRV\Programmability\Procedures\Procedures.html" data-mapping-enabled="true">Stored Procedures</a></li>
            <li class="active">zabbix.GetExistsErrorInLog</li>
          </ol>
        </div>
      </div>
      <div class="row">
        <div class="title col-xs-12">
          <div><img class="inline-middle image-large" src="../../../../../../images/procedure.svg" title="zabbix.GetExistsErrorInLog" />
            <h1 class="inline-middle">zabbix.GetExistsErrorInLog</h1>
            <div class="dropdown actions-btn-wrap">
              <button type="button" class="btn btn-default actions-btn" data-toggle="dropdown"><span class="icon-actions icon-small actions-btn-span"></span></button>
              <ul class="dropdown-menu dropdown-menu-right">
                <li><a id="CollapseAll" href="#">Collapse All</a></li>
                <li><a id="ExpandAll" href="#">Expand All</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="content">
      <div id="Description" class="panel panel-default">
        <div class="panel-heading">
          <span class="icon-bottom inline-middle expanded icon-small"></span>
          <span class="icon-right inline-middle collapsed icon-small" style="display:none"></span>
          <h2 class="inline-middle">Description</h2>
        </div>
        <div class="panel-collapse collapse in">
          <div class="panel-body">
            <span>Возвращает признак существования в журнале ошибок MS SQL Server подозрительных записей</span>
          </div>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">
          <span class="icon-bottom inline-middle expanded icon-small"></span>
          <span class="icon-right inline-middle collapsed icon-small" style="display:none"></span>
          <h2 class="inline-middle">Properties</h2>
        </div>
        <div class="panel-collapse collapse in">
          <div class="panel-body">
            <table class="table table-hover table-bordered">
              <tbody>
                <tr>
                  <th>Name</th>
                  <th>Value</th>
                </tr>
                <tr>
                  <td>ANSI Nulls ON</td>
                  <td><p class="value-true">True</p></td>
                </tr>
                <tr>
                  <td>Quoted Identifier ON</td>
                  <td><p class="value-true">True</p></td>
                </tr>
                <tr>
                  <td>Encrypted</td>
                  <td><p class="value-false">False</p></td>
                </tr>
                <tr>
                  <td>Execute As</td>
                  <td></td>
                </tr>
                <tr>
                  <td>Assembly</td>
                  <td></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div id="SqlScript" class="panel panel-default">
        <div class="panel-heading">
          <span class="icon-bottom inline-middle expanded icon-small"></span>
          <span class="icon-right inline-middle collapsed icon-small" style="display:none"></span>
          <h2 class="inline-middle">SQL Script</h2>
        </div>
        <div class="panel-collapse collapse in">
          <div class="panel-body">
            <div class="sqlscript panel-default">
              <font color="#0000ff">SET</font>&nbsp;<font color="#0000ff">QUOTED_IDENTIFIER</font><font color="#808080">,</font>&nbsp;<font color="#0000ff">ANSI_NULLS</font>&nbsp;<font color="#0000ff">ON</font><br><font color="#0000ff">GO</font><br><font color="#000000"></font><br><font color="#000000"></font><br><font color="#000000"></font><br><font color="#000000"></font><br><font color="#000000"></font><br><font color="#008000">-- =============================================</font><br><font color="#008000">-- Author:		<Author,,Name></font><br><font color="#008000">-- Create date: <Create Date,,></font><br><font color="#008000">-- Description:	<Description,,></font><br><font color="#008000">-- =============================================</font><br><font color="#0000ff">CREATE</font>&nbsp;<font color="#808080">OR</font>&nbsp;<font color="#0000ff">ALTER</font>&nbsp;<font color="#0000ff">PROCEDURE</font>&nbsp;<font color="#008080">zabbix</font><font color="#808080">.</font><font color="#008080">GetExistsErrorInLog</font><br><font color="#0000ff">AS</font><br><font color="#0000ff">BEGIN</font><br>&nbsp;<br><font color="#008000">/*
		Признак существования в журнале ошибок MS SQL Server подозрительных записей
	*/</font><br><font color="#000000"></font><br>&nbsp;<font color="#008000">--SET QUERY_GOVERNOR_COST_LIMIT 0;</font><br>&nbsp;<font color="#0000ff">SET</font>&nbsp;<font color="#0000ff">NOCOUNT</font>&nbsp;<font color="#0000ff">ON</font><font color="#808080">;</font><br>&nbsp;<font color="#0000ff">SET</font>&nbsp;<font color="#0000ff">TRANSACTION</font>&nbsp;<font color="#0000ff">ISOLATION</font>&nbsp;<font color="#0000ff">LEVEL</font>&nbsp;<font color="#0000ff">READ</font>&nbsp;<font color="#0000ff">UNCOMMITTED</font><font color="#808080">;</font><br>&nbsp;<font color="#0000ff">SET</font>&nbsp;<font color="#0000ff">XACT_ABORT</font>&nbsp;<font color="#0000ff">ON</font><font color="#808080">;</font><br><font color="#000000"></font><br>&nbsp;<font color="#0000ff">declare</font>&nbsp;<font color="#008080">@rez</font>&nbsp;<font color="#0000ff">bit</font><font color="#808080">=</font><font color="#000000">0</font><font color="#808080">;</font><br><font color="#000000"></font><br>&nbsp;<font color="#0000ff">declare</font>&nbsp;<font color="#008080">@dt</font>&nbsp;<font color="#0000ff">datetime</font><font color="#808080">=</font><font color="#ff00ff">DateAdd</font><font color="#808080">(</font><font color="#0000ff">hour</font><font color="#808080">,</font>&nbsp;<font color="#808080">-</font><font color="#000000">3</font><font color="#808080">,</font>&nbsp;<font color="#ff00ff">GetDate</font><font color="#808080">(</font><font color="#808080">)</font><font color="#808080">)</font><font color="#808080">;</font><br>&nbsp;<font color="#0000ff">declare</font>&nbsp;<font color="#008080">@str</font>&nbsp;<font color="#0000ff">nvarchar</font><font color="#808080">(</font><font color="#000000">255</font><font color="#808080">)</font><font color="#808080">=</font><font color="#ff00ff">cast</font><font color="#808080">(</font><font color="#008080">@dt</font>&nbsp;<font color="#0000ff">as</font>&nbsp;<font color="#0000ff">nvarchar</font><font color="#808080">(</font><font color="#000000">255</font><font color="#808080">)</font><font color="#808080">)</font><font color="#808080">;</font><br>&nbsp;<br>&nbsp;<font color="#0000ff">declare</font>&nbsp;<font color="#008080">@tbl</font>&nbsp;<font color="#0000ff">table</font>&nbsp;<font color="#808080">(</font><font color="#008080">[LogDate]</font>&nbsp;<font color="#0000ff">datetime</font><font color="#808080">,</font>&nbsp;<font color="#008080">[ProcessInfo]</font>&nbsp;<font color="#0000ff">nvarchar</font><font color="#808080">(</font><font color="#000000">255</font><font color="#808080">)</font><font color="#808080">,</font>&nbsp;<font color="#008080">[Text]</font>&nbsp;<font color="#0000ff">nvarchar</font><font color="#808080">(</font><font color="#ff00ff">max</font><font color="#808080">)</font><font color="#808080">)</font><font color="#808080">;</font><br>&nbsp;<font color="#0000ff">declare</font>&nbsp;<font color="#008080">@tbl_filtered</font>&nbsp;<font color="#0000ff">table</font>&nbsp;<font color="#808080">(</font><font color="#008080">[LogDate]</font>&nbsp;<font color="#0000ff">datetime</font><font color="#808080">,</font>&nbsp;<font color="#008080">[ProcessInfo]</font>&nbsp;<font color="#0000ff">nvarchar</font><font color="#808080">(</font><font color="#000000">255</font><font color="#808080">)</font><font color="#808080">,</font>&nbsp;<font color="#008080">[Text]</font>&nbsp;<font color="#0000ff">nvarchar</font><font color="#808080">(</font><font color="#ff00ff">max</font><font color="#808080">)</font><font color="#808080">)</font><font color="#808080">;</font><br><font color="#000000"></font><br>&nbsp;<font color="#0000ff">declare</font>&nbsp;<font color="#008080">@server_name</font>&nbsp;<font color="#0000ff">nvarchar</font><font color="#808080">(</font><font color="#000000">255</font><font color="#808080">)</font><font color="#808080">=</font><font color="#ff00ff">cast</font><font color="#808080">(</font><font color="#ff00ff">SERVERPROPERTY</font><font color="#808080">(</font><font color="#ff0000">N'ComputerNamePhysicalNetBIOS'</font><font color="#808080">)</font>&nbsp;<font color="#0000ff">as</font>&nbsp;<font color="#0000ff">nvarchar</font><font color="#808080">(</font><font color="#000000">255</font><font color="#808080">)</font><font color="#808080">)</font><font color="#808080">;</font><br><font color="#000000"></font><br>&nbsp;<font color="#0000ff">if</font><font color="#808080">(</font><font color="#808080">(</font><font color="#0000ff">left</font><font color="#808080">(</font><font color="#008080">@server_name</font><font color="#808080">,</font><font color="#000000">3</font><font color="#808080">)</font>&nbsp;<font color="#808080">in</font>&nbsp;<font color="#808080">(</font><font color="#ff0000">N'PRD'</font><font color="#808080">)</font><font color="#808080">)</font>&nbsp;<font color="#808080">or</font>&nbsp;<font color="#808080">(</font><font color="#008080">@server_name</font>&nbsp;<font color="#808080">like</font>&nbsp;<font color="#ff0000">'SQL_SERVICES%'</font><font color="#808080">)</font>&nbsp;<font color="#808080">or</font>&nbsp;<font color="#808080">(</font><font color="#008080">@server_name</font>&nbsp;<font color="#808080">in</font>&nbsp;<font color="#808080">(</font><font color="#ff0000">'com-dba-01'</font><font color="#808080">)</font><font color="#808080">)</font><font color="#808080">)</font><br>&nbsp;<font color="#0000ff">begin</font><br>&nbsp;&nbsp;<font color="#008000">--читкаем текущий журнал</font><br>&nbsp;&nbsp;<font color="#0000ff">insert</font>&nbsp;<font color="#0000ff">into</font>&nbsp;<font color="#008080">@tbl</font>&nbsp;<font color="#808080">(</font><font color="#008080">[LogDate]</font><font color="#808080">,</font>&nbsp;<font color="#008080">[ProcessInfo]</font><font color="#808080">,</font>&nbsp;<font color="#008080">[Text]</font><font color="#808080">)</font><br>&nbsp;&nbsp;<font color="#0000ff">EXEC</font>&nbsp;<font color="#0000ff">master</font><font color="#808080">.</font><font color="#008000">dbo</font><font color="#808080">.</font><font color="#008080">xp_readerrorlog</font>&nbsp;<font color="#000000">0</font><font color="#808080">,</font>&nbsp;<font color="#000000">1</font><font color="#808080">,</font>&nbsp;<font color="#ff0000">N'cost limit'</font><font color="#808080">,</font>&nbsp;<font color="#808080">NULL</font><font color="#808080">,</font>&nbsp;<font color="#008080">@str</font><font color="#808080">,</font>&nbsp;<font color="#808080">NULL</font><font color="#808080">,</font>&nbsp;<font color="#ff0000">'DESC'</font><font color="#808080">;</font>&nbsp;<font color="#008000">--один раз-пищать</font><br>&nbsp;&nbsp;<br>&nbsp;&nbsp;<font color="#0000ff">insert</font>&nbsp;<font color="#0000ff">into</font>&nbsp;<font color="#008080">@tbl</font>&nbsp;<font color="#808080">(</font><font color="#008080">[LogDate]</font><font color="#808080">,</font>&nbsp;<font color="#008080">[ProcessInfo]</font><font color="#808080">,</font>&nbsp;<font color="#008080">[Text]</font><font color="#808080">)</font><br>&nbsp;&nbsp;<font color="#0000ff">EXEC</font>&nbsp;<font color="#0000ff">master</font><font color="#808080">.</font><font color="#008000">dbo</font><font color="#808080">.</font><font color="#008080">xp_readerrorlog</font>&nbsp;<font color="#000000">0</font><font color="#808080">,</font>&nbsp;<font color="#000000">1</font><font color="#808080">,</font>&nbsp;<font color="#ff0000">N'failed'</font><font color="#808080">,</font>&nbsp;<font color="#808080">NULL</font><font color="#808080">,</font>&nbsp;<font color="#008080">@str</font><font color="#808080">,</font>&nbsp;<font color="#808080">NULL</font><font color="#808080">,</font>&nbsp;<font color="#ff0000">'DESC'</font><font color="#808080">;</font><font color="#008000">--при [ProcessInfo]='Logon' проверить частоту, а в остальных случаях-пищать</font><br>&nbsp;&nbsp;<br>&nbsp;&nbsp;<font color="#008000">--insert into @tbl ([LogDate], [ProcessInfo], [Text])</font><br>&nbsp;&nbsp;<font color="#008000">--EXEC master.dbo.xp_readerrorlog 1, 1, N'cost limit', NULL, NULL, NULL, 'DESC'; --один раз-пищать</font><br>&nbsp;&nbsp;<br>&nbsp;&nbsp;<font color="#008000">--insert into @tbl ([LogDate], [ProcessInfo], [Text])</font><br>&nbsp;&nbsp;<font color="#008000">--EXEC master.dbo.xp_readerrorlog 1, 1, N'failed', NULL, NULL, NULL, 'DESC';--при [ProcessInf`o]='Logon' проверить частоту, а в остальных случаях-пищать</font><br>&nbsp;&nbsp;<br>&nbsp;&nbsp;<font color="#008000">--insert into @tbl ([LogDate], [ProcessInfo], [Text])</font><br>&nbsp;&nbsp;<font color="#008000">--EXEC master.dbo.xp_readerrorlog 2, 1, N'cost limit', NULL, NULL, NULL, 'DESC'; --один раз-пищать</font><br>&nbsp;&nbsp;<br>&nbsp;&nbsp;<font color="#008000">--insert into @tbl ([LogDate], [ProcessInfo], [Text])</font><br>&nbsp;&nbsp;<font color="#008000">--EXEC master.dbo.xp_readerrorlog 2, 1, N'failed', NULL, NULL, NULL, 'DESC';--при [ProcessInfo]='Logon' проверить частоту, а в остальных случаях-пищать</font><br>&nbsp;&nbsp;<br>&nbsp;&nbsp;<font color="#008000">--insert into @tbl ([LogDate], [ProcessInfo], [Text])</font><br>&nbsp;&nbsp;<font color="#008000">--EXEC master.dbo.xp_readerrorlog 3, 1, N'cost limit', NULL, NULL, NULL, 'DESC'; --один раз-пищать</font><br>&nbsp;&nbsp;<br>&nbsp;&nbsp;<font color="#008000">--insert into @tbl ([LogDate], [ProcessInfo], [Text])</font><br>&nbsp;&nbsp;<font color="#008000">--EXEC master.dbo.xp_readerrorlog 3, 1, N'failed', NULL, NULL, NULL, 'DESC';--при [ProcessInfo]='Logon' проверить частоту, а в остальных случаях-пищать</font><br>&nbsp;&nbsp;<br>&nbsp;&nbsp;<font color="#008000">--insert into @tbl ([LogDate], [ProcessInfo], [Text])</font><br>&nbsp;&nbsp;<font color="#008000">--EXEC master.dbo.xp_readerrorlog 4, 1, N'cost limit', NULL, NULL, NULL, 'DESC'; --один раз-пищать</font><br>&nbsp;&nbsp;<br>&nbsp;&nbsp;<font color="#008000">--insert into @tbl ([LogDate], [ProcessInfo], [Text])</font><br>&nbsp;&nbsp;<font color="#008000">--EXEC master.dbo.xp_readerrorlog 4, 1, N'failed', NULL, NULL, NULL, 'DESC';--при [ProcessInfo]='Logon' проверить частоту, а в остальных случаях-пищать</font><br>&nbsp;&nbsp;<br>&nbsp;&nbsp;<font color="#008000">--insert into @tbl ([LogDate], [ProcessInfo], [Text])</font><br>&nbsp;&nbsp;<font color="#008000">--EXEC master.dbo.xp_readerrorlog 5, 1, N'cost limit', NULL, NULL, NULL, 'DESC'; --один раз-пищать</font><br>&nbsp;&nbsp;<br>&nbsp;&nbsp;<font color="#008000">--insert into @tbl ([LogDate], [ProcessInfo], [Text])</font><br>&nbsp;&nbsp;<font color="#008000">--EXEC master.dbo.xp_readerrorlog 5, 1, N'failed', NULL, NULL, NULL, 'DESC';--при [ProcessInfo]='Logon' проверить частоту, а в остальных случаях-пищать</font><br>&nbsp;&nbsp;<br>&nbsp;&nbsp;<font color="#008000">--insert into @tbl ([LogDate], [ProcessInfo], [Text])</font><br>&nbsp;&nbsp;<font color="#008000">--EXEC master.dbo.xp_readerrorlog 6, 1, N'cost limit', NULL, NULL, NULL, 'DESC'; --один раз-пищать</font><br>&nbsp;&nbsp;<br>&nbsp;&nbsp;<font color="#008000">--insert into @tbl ([LogDate], [ProcessInfo], [Text])</font><br>&nbsp;&nbsp;<font color="#008000">--EXEC master.dbo.xp_readerrorlog 6, 1, N'failed', NULL, NULL, NULL, 'DESC';--при [ProcessInfo]='Logon' проверить частоту, а в остальных случаях-пищать</font><br>&nbsp;&nbsp;<br>&nbsp;&nbsp;<font color="#0000ff">insert</font>&nbsp;<font color="#0000ff">into</font>&nbsp;<font color="#008080">@tbl_filtered</font>&nbsp;<font color="#808080">(</font><font color="#008080">[LogDate]</font><font color="#808080">,</font>&nbsp;<font color="#008080">[ProcessInfo]</font><font color="#808080">,</font>&nbsp;<font color="#008080">[Text]</font><font color="#808080">)</font><br>&nbsp;&nbsp;<font color="#0000ff">select</font>&nbsp;<font color="#008080">[LogDate]</font><font color="#808080">,</font>&nbsp;<font color="#008080">[ProcessInfo]</font><font color="#808080">,</font>&nbsp;<font color="#008080">[Text]</font><br>&nbsp;&nbsp;<font color="#0000ff">from</font>&nbsp;<font color="#008080">@tbl</font><br>&nbsp;&nbsp;<font color="#0000ff">where</font>&nbsp;<font color="#008080">[Text]</font>&nbsp;<font color="#808080">not</font>&nbsp;<font color="#808080">like</font>&nbsp;<font color="#ff0000">N'Audit: Server Audit: %Initialized and Assigned State: START_FAILED'</font><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080">and</font>&nbsp;<font color="#008080">[Text]</font>&nbsp;<font color="#808080"><</font><font color="#808080">></font>&nbsp;<font color="#ff0000">N'Creating view sysmail_faileditems...'</font><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080">and</font>&nbsp;<font color="#008080">[Text]</font>&nbsp;<font color="#808080">not</font>&nbsp;<font color="#808080">like</font>&nbsp;<font color="#ff0000">N'Configuration option % changed from %. Run the RECONFIGURE statement to install.'</font><br>&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">--and [Text] <> N'Perfmon counters for resource governor pools and groups failed to initialize and are disabled.'</font><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">--and [Text] <> N'A read operation on a large object failed while sending data to the client. A common cause for this is if the application is running in READ UNCOMMITTED isolation level. This connection will be terminated.'</font><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">--and [Text] <> N'Implied authentication manager initialization failed. Implied authentication will be disabled.'</font><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">--and [Text] <> N'InitializeExternalUserGroupSid failed. Implied authentication will be disabled.'</font><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">--and [Text] not like N'Login failed%'</font><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">--and [Text] not like N'BACKUP failed to complete the command BACKUP%'</font><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">--and [Text] not like N'The client was unable to reuse a session with SPID %, which had been reset for connection pooling. The failure ID is %. This error may have been caused by an earlier operation failing. Check the error logs for failed operations immediately before this error message.'</font><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">--and [Text] not like N'BackupDiskFile::CreateMedia: Backup device %'</font><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">--and [Text] not like N'FCB::Open failed: Could not open file %'</font><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">--and [Text] not like N'One or more recovery units belonging to database % failed to generate a checkpoint. This is typically caused by lack of system resources such as disk or memory, or in some cases due to database corruption. Examine previous entries in the error log for more detailed information on this failure.'</font><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">--and [Text] not like N'SSPI handshake failed with error code %, state % while establishing a connection with integrated security; the connection has been closed. Reason: AcceptSecurityContext failed. The Windows error code indicates the cause of failure. The logon attempt failed %'</font><br>&nbsp;&nbsp;<font color="#008000">--group by [ProcessInfo], [Text]</font><br>&nbsp;&nbsp;<font color="#008000">--where [LogDate]>='2019-05-14T00:00:00'</font><br>&nbsp;&nbsp;<br>&nbsp;&nbsp;<font color="#0000ff">if</font><font color="#808080">(</font><font color="#808080">exists</font><font color="#808080">(</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">select</font>&nbsp;<font color="#0000ff">top</font><font color="#808080">(</font><font color="#000000">1</font><font color="#808080">)</font>&nbsp;<font color="#000000">1</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">from</font>&nbsp;<font color="#008080">@tbl_filtered</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">where</font>&nbsp;<font color="#008080">[ProcessInfo]</font><font color="#808080">=</font><font color="#ff0000">'Logon'</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">group</font>&nbsp;<font color="#0000ff">by</font>&nbsp;<font color="#008080">[Text]</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">having</font>&nbsp;<font color="#ff00ff">count</font><font color="#808080">(</font><font color="#808080">*</font><font color="#808080">)</font><font color="#808080">></font><font color="#808080">=</font><font color="#000000">5</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080">)</font><font color="#808080">)</font><br>&nbsp;&nbsp;<font color="#0000ff">begin</font><br>&nbsp;&nbsp;&nbsp;<font color="#0000ff">set</font>&nbsp;<font color="#008080">@rez</font><font color="#808080">=</font><font color="#000000">1</font><font color="#808080">;</font><br>&nbsp;&nbsp;<font color="#0000ff">end</font><br><font color="#000000"></font><br>&nbsp;&nbsp;<font color="#0000ff">if</font><font color="#808080">(</font><font color="#008080">@rez</font><font color="#808080">=</font><font color="#000000">0</font><font color="#808080">)</font><br>&nbsp;&nbsp;<font color="#0000ff">begin</font><br>&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font><font color="#808080">(</font><font color="#808080">exists</font><font color="#808080">(</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">select</font>&nbsp;<font color="#0000ff">top</font><font color="#808080">(</font><font color="#000000">1</font><font color="#808080">)</font>&nbsp;<font color="#000000">1</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">from</font>&nbsp;<font color="#008080">@tbl_filtered</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">where</font>&nbsp;<font color="#008080">[Text]</font>&nbsp;<font color="#808080">not</font>&nbsp;<font color="#808080">like</font>&nbsp;<font color="#ff0000">N'Login failed%'</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080">)</font><font color="#808080">)</font><br>&nbsp;&nbsp;&nbsp;<font color="#0000ff">begin</font><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">set</font>&nbsp;<font color="#008080">@rez</font><font color="#808080">=</font><font color="#000000">1</font><font color="#808080">;</font><br>&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>&nbsp;&nbsp;<font color="#0000ff">end</font><br>&nbsp;<font color="#0000ff">end</font><br>&nbsp;<font color="#0000ff">else</font>&nbsp;<font color="#0000ff">set</font>&nbsp;<font color="#008080">@rez</font><font color="#808080">=</font><font color="#000000">0</font><font color="#808080">;</font><br><font color="#000000"></font><br>&nbsp;<font color="#0000ff">select</font>&nbsp;<font color="#ff00ff">cast</font><font color="#808080">(</font><font color="#008080">@rez</font>&nbsp;<font color="#0000ff">as</font>&nbsp;<font color="#0000ff">int</font><font color="#808080">)</font>&nbsp;<font color="#0000ff">as</font>&nbsp;<font color="#008080">[value]</font><font color="#808080">;</font><br><font color="#0000ff">END</font><br><font color="#0000ff">GO</font><br><font color="#000000"></font><br><font color="#0000ff">EXEC</font>&nbsp;<font color="#008000">sys</font><font color="#808080">.</font><font color="#800000">sp_addextendedproperty</font>&nbsp;<font color="#ff0000">N'MS_Description'</font><font color="#808080">,</font>&nbsp;<font color="#ff0000">N'Возвращает признак существования в журнале ошибок MS SQL Server подозрительных записей'</font><font color="#808080">,</font>&nbsp;<font color="#ff0000">'SCHEMA'</font><font color="#808080">,</font>&nbsp;<font color="#ff0000">N'zabbix'</font><font color="#808080">,</font>&nbsp;<font color="#ff0000">'PROCEDURE'</font><font color="#808080">,</font>&nbsp;<font color="#ff0000">N'GetExistsErrorInLog'</font><br><font color="#0000ff">GO</font></div>
          </div>
        </div>
      </div>
      <div id="DependsOn" class="panel panel-default">
        <div class="panel-heading">
          <span class="icon-bottom inline-middle expanded icon-small"></span>
          <span class="icon-right inline-middle collapsed icon-small" style="display:none"></span>
          <h2 class="inline-middle">Depends On</h2>
          <span class="badge inline-middle">1</span>
        </div>
        <div class="panel-collapse collapse in">
          <div class="panel-body">
            <ul class="items-list">
              <li><a href="../../../../../../Servers\SRV\UserDatabases\SRV\Security\Schemas\zabbix.html" data-mapping-enabled="true"><span>zabbix</span></a></li>
            </ul>
          </div>
        </div>
      </div>
      <div id="UsedBy" class="panel panel-default">
        <div class="panel-heading">
          <span class="icon-bottom inline-middle expanded icon-small"></span>
          <span class="icon-right inline-middle collapsed icon-small" style="display:none"></span>
          <h2 class="inline-middle">Used By</h2>
        </div>
        <div class="panel-collapse collapse in">
          <div class="panel-body">
            <span class="text-muted">No items found</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="footer">
    <div class="col-xs-4">Author:&nbsp;</div>
    <div class="col-xs-4 align-center">Copyright &#169; All Rights Reserved</div>
    <div class="col-xs-4 align-right">Created:&nbsp;26.12.2019</div>
  </div>
</body>
</html>