CREATE view [srv].[vPlanQuery] as 
SELECT pq.[PlanHandle]
      ,pq.[SQLHandle]
      ,pq.[QueryPlan]
      ,sq.[TSQL]
      ,pq.[InsertUTCDate]
	  ,pq.[dop]
      ,pq.[request_time]
      ,pq.[grant_time]
      ,pq.[requested_memory_kb]
      ,pq.[granted_memory_kb]
      ,pq.[required_memory_kb]
      ,pq.[used_memory_kb]
      ,pq.[max_used_memory_kb]
      ,pq.[query_cost]
      ,pq.[timeout_sec]
      ,pq.[resource_semaphore_id]
      ,pq.[queue_id]
      ,pq.[wait_order]
      ,pq.[is_next_candidate]
      ,pq.[wait_time_ms]
      ,pq.[pool_id]
      ,pq.[is_small]
      ,pq.[ideal_memory_kb]
      ,pq.[reserved_worker_count]
      ,pq.[used_worker_count]
      ,pq.[max_used_worker_count]
      ,pq.[reserved_node_bitmap]
      ,pq.[bucketid]
      ,pq.[refcounts]
      ,pq.[usecounts]
      ,pq.[size_in_bytes]
      ,pq.[memory_object_address]
      ,pq.[cacheobjtype]
      ,pq.[objtype]
      ,pq.[parent_plan_handle]
      ,pq.[creation_time]
      ,pq.[execution_count]
      ,pq.[total_worker_time]
      ,pq.[min_last_worker_time]
      ,pq.[max_last_worker_time]
      ,pq.[min_worker_time]
      ,pq.[max_worker_time]
      ,pq.[total_physical_reads]
      ,pq.[min_last_physical_reads]
      ,pq.[max_last_physical_reads]
      ,pq.[min_physical_reads]
      ,pq.[max_physical_reads]
      ,pq.[total_logical_writes]
      ,pq.[min_last_logical_writes]
      ,pq.[max_last_logical_writes]
      ,pq.[min_logical_writes]
      ,pq.[max_logical_writes]
      ,pq.[total_logical_reads]
      ,pq.[min_last_logical_reads]
      ,pq.[max_last_logical_reads]
      ,pq.[min_logical_reads]
      ,pq.[max_logical_reads]
      ,pq.[total_clr_time]
      ,pq.[min_last_clr_time]
      ,pq.[max_last_clr_time]
      ,pq.[min_clr_time]
      ,pq.[max_clr_time]
      ,pq.[min_last_elapsed_time]
      ,pq.[max_last_elapsed_time]
      ,pq.[min_elapsed_time]
      ,pq.[max_elapsed_time]
      ,pq.[total_rows]
      ,pq.[min_last_rows]
      ,pq.[max_last_rows]
      ,pq.[min_rows]
      ,pq.[max_rows]
      ,pq.[total_dop]
      ,pq.[min_last_dop]
      ,pq.[max_last_dop]
      ,pq.[min_dop]
      ,pq.[max_dop]
      ,pq.[total_grant_kb]
      ,pq.[min_last_grant_kb]
      ,pq.[max_last_grant_kb]
      ,pq.[min_grant_kb]
      ,pq.[max_grant_kb]
      ,pq.[total_used_grant_kb]
      ,pq.[min_last_used_grant_kb]
      ,pq.[max_last_used_grant_kb]
      ,pq.[min_used_grant_kb]
      ,pq.[max_used_grant_kb]
      ,pq.[total_ideal_grant_kb]
      ,pq.[min_last_ideal_grant_kb]
      ,pq.[max_last_ideal_grant_kb]
      ,pq.[min_ideal_grant_kb]
      ,pq.[max_ideal_grant_kb]
      ,pq.[total_reserved_threads]
      ,pq.[min_last_reserved_threads]
      ,pq.[max_last_reserved_threads]
      ,pq.[min_reserved_threads]
      ,pq.[max_reserved_threads]
      ,pq.[total_used_threads]
      ,pq.[min_last_used_threads]
      ,pq.[max_last_used_threads]
      ,pq.[min_used_threads]
      ,pq.[max_used_threads]
  FROM [srv].[PlanQuery] as pq
  inner join [srv].[SQLQuery] as sq on sq.[SQLHandle]=pq.[SQLHandle]

GO
EXECUTE sp_addextendedproperty @name = N'MS_Description', @value = N'Планы запросов', @level0type = N'SCHEMA', @level0name = N'srv', @level1type = N'VIEW', @level1name = N'vPlanQuery';

